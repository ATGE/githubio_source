---
title: "CCI Ram Upgrades"
description: "<p>Sometimes I just can't be bothered to do things in the normal way. Now, I can enjoy a good ole zen activity like th"
date: "2012-10-26"
author: "phil"
tags:
    - "blog"
---

<p>Sometimes I just can't be bothered to do things in the "normal" way. Now, I can enjoy a good ole zen activity like the occasional manual data entry, but in general if I have to repeat a task more than a few times I get antsy. And I am not completely unsure that someone smart and sucessful said something good about lazy people. So in my quest for maximum return for minimal effort I find myself collecting various useful snippets and scripts. Today we will go through one in my collection.</p>
<p>Upgrading a CCI through the SLAPI is a fairly straight forward process which invloves creating an order container of type <a href="/reference/datatypes/SoftLayer_Container_Product_Order_Virtual_Guest_Upgrade/">SoftLayer_Container_Product_Order_Virtual_Guest_Upgrade</a>. In addition to the usual suspects this container will also require a property by the name of <span class="geshifilter"><code class="text geshifilter-text">MAINTENANCE_WINDOW</code></span>.</p>
<p>Import the SLAPI, datetime which will provide the current time stamp for our maintenance window and pretty printer because no one likes ugly print...</p>
<div class="geshifilter">
<pre class="python geshifilter-python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> SoftLayer.<span style="color: black;">API</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">pprint</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">pprint</span> <span style="color: #ff7700;font-weight:bold;">as</span> pp</pre></div>
<p>This <a href="https://sldn.softlayer.com/blog/tgarrison/Helper-Functions-Small-Changes-Big-Win">helper function</a> takes in the amount of RAM you wish set for your CCI as an int and returns the prices array needed for the order container. Take note of the anonmyous function on the len() check...nested foreach loops are cool and all, but this is much more fun.</p>
<div class="geshifilter">
<pre class="python geshifilter-python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Find the priceId for the RAM item matching our defined memory allotment</span>
<span style="color: #ff7700;font-weight:bold;">def</span> getMemoryPrice<span style="color: black;">&#40;</span>memoryCapacity<span style="color: black;">&#41;</span>:
    packageClient <span style="color: #66cc66;">=</span> SoftLayer.<span style="color: black;">API</span>.<span style="color: black;">Client</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'SoftLayer_Product_Package'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">46</span><span style="color: #66cc66;">,</span> apiUsername<span style="color: #66cc66;">,</span> apiKey<span style="color: black;">&#41;</span>
    objectMask <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"mask[capacity;prices.id;categories[name,id]]"</span>
    packageClient.<span style="color: black;">set_object_mask</span><span style="color: black;">&#40;</span>objectMask<span style="color: black;">&#41;</span>
    items <span style="color: #66cc66;">=</span> packageClient.<span style="color: black;">getItems</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> item <span style="color: #ff7700;font-weight:bold;">in</span> items:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span><span style="color: #008000;">filter</span><span style="color: black;">&#40;</span><span style="color: #ff7700;font-weight:bold;">lambda</span> x: x.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'id'</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">==</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> item<span style="color: black;">&#91;</span><span style="color: #483d8b;">'categories'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> \\
        <span style="color: #ff7700;font-weight:bold;">and</span> item.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'capacity'</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">==</span> <span style="color: #008000;">str</span><span style="color: black;">&#40;</span>memoryCapacity<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> item<span style="color: black;">&#91;</span><span style="color: #483d8b;">'prices'</span><span style="color: black;">&#93;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'id'</span><span style="color: black;">&#93;</span></pre></div>
<p>This function puts all our data together in the needed format then sends it off to processing where the unicorns churn it into server dust.</p>
<div class="geshifilter">
<pre class="python geshifilter-python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Create the upgrade order container and send the order to the API. Replace</span>
<span style="color: #808080; font-style: italic;"># verifyOrder() with placeOrder() after testing</span>
<span style="color: #ff7700;font-weight:bold;">def</span> upgradeOrder<span style="color: black;">&#40;</span>virtualGuestId<span style="color: #66cc66;">,</span> memoryPriceId<span style="color: black;">&#41;</span>:
    orderClient <span style="color: #66cc66;">=</span> SoftLayer.<span style="color: black;">API</span>.<span style="color: black;">Client</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'SoftLayer_Product_Order'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> apiUsername<span style="color: #66cc66;">,</span> apiKey<span style="color: black;">&#41;</span>
    orderContainer <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
    orderContainer<span style="color: black;">&#91;</span><span style="color: #483d8b;">'complexType'</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'SoftLayer_Container_Product_Order_Virtual_Guest_Upgrade'</span>
    orderContainer<span style="color: black;">&#91;</span><span style="color: #483d8b;">'virtualGuests'</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#123;</span><span style="color: #483d8b;">'id'</span>: virtualGuestId<span style="color: black;">&#125;</span><span style="color: black;">&#93;</span>
    orderContainer<span style="color: black;">&#91;</span><span style="color: #483d8b;">'prices'</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#123;</span><span style="color: #483d8b;">'id'</span>: memoryPriceId<span style="color: black;">&#125;</span><span style="color: black;">&#93;</span>
    orderContainer<span style="color: black;">&#91;</span><span style="color: #483d8b;">'properties'</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#123;</span><span style="color: #483d8b;">'name'</span>: <span style="color: #483d8b;">'MAINTENANCE_WINDOW'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'value'</span>: <span style="color: #008000;">str</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#125;</span><span style="color: black;">&#93;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> orderClient.<span style="color: black;">verifyOrder</span><span style="color: black;">&#40;</span>orderContainer<span style="color: black;">&#41;</span></pre></div>
<p>To wrap up: our implimentation of argsparse to handle the command line arguments, our API username and API key and our call to upgradeOrder which sets the process in motion.</p>
<div class="geshifilter">
<pre class="python geshifilter-python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Define our arguments and start the process</span>
<span style="color: #ff7700;font-weight:bold;">if</span> __name__ <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">"__main__"</span>:
    <span style="color: #ff7700;font-weight:bold;">import</span> argparse
&nbsp;
    argsparse <span style="color: #66cc66;">=</span> argparse.<span style="color: black;">ArgumentParser</span><span style="color: black;">&#40;</span>description<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'Upgrade a CCI<span style="color: #000099; font-weight: bold;">\\'</span>s Memory'</span><span style="color: black;">&#41;</span>
    argsparse.<span style="color: black;">add_argument</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'virtualGuestId'</span><span style="color: #66cc66;">,</span> metavar<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'Virtual Guest ID'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">type</span><span style="color: #66cc66;">=</span><span style="color: #008000;">int</span><span style="color: #66cc66;">,</span>
        <span style="color: #008000;">help</span><span style="color: #66cc66;">=</span><span style="color: #483d8b;">'ID of the target CCI.'</span><span style="color: black;">&#41;</span>
    argsparse.<span style="color: black;">add_argument</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'memoryCapacity'</span><span style="color: #66cc66;">,</span> metavar<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'Ram GBs'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">type</span><span style="color: #66cc66;">=</span><span style="color: #008000;">int</span><span style="color: #66cc66;">,</span>
        <span style="color: #008000;">help</span><span style="color: #66cc66;">=</span><span style="color: #483d8b;">'Amount of RAM in GB.'</span><span style="color: black;">&#41;</span>
&nbsp;
    args <span style="color: #66cc66;">=</span> argsparse.<span style="color: black;">parse_args</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    apiUsername <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">''</span>
    apiKey <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">''</span>
    pp<span style="color: black;">&#40;</span>upgradeOrder<span style="color: black;">&#40;</span>args.<span style="color: black;">virtualGuestId</span><span style="color: #66cc66;">,</span> getMemoryPrice<span style="color: black;">&#40;</span>args.<span style="color: black;">memoryCapacity</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></div>
<p>Now with the syntax <span class="geshifilter"><code class="text geshifilter-text">python upgradeCCI.py <serverId> <ram amount in GB></code></span> we can easily place a RAM upgrade order. Remember to reboot your CCI after the order is complete to take advantage of your newly aquired memory.</p>
<p>-Phil</p>

