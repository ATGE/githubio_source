---
title: "The Object of My Backup Storage"
description: "<p><strong>TL;DR:  I deleted my personal site, restored it, and wrote an awesome rsync-like backup script that's really "
date: "2012-05-14"
author: "klandreth"
tags:
    - "blog"
---

<p><strong>TL;DR:  I deleted my personal site, restored it, and wrote an awesome rsync-like backup script that's really fast and easy on IO.  Github link at the end of the article.</strong></p>
<p>Ever had a dangling symlink ruin your <span class="geshifilter"><code class="text geshifilter-text">rm-rf</code></span>?  The weight of your confidence creeps down into that area that isnt necessarily your stomach, but it's easy enough to call it such for conversation upon the realization that your previous command should have returned quite a bit sooner.  This recently happened to me on a personal site I co-admin while doing some trivial filesystem cleanup. The end result being over 30GB worth of user contributed content, the primary content of this site, deleted.  After everything was back to where it belonged and the 404's were back down to an acceptable level, I began looking for a new backup strategy.  Storing files locally wasn't an option (nor should it ever be) and a CCI for backup storage didn't seem cost effective to me as I would end up managing and paying for disk space I wouldn't necessarily use. </p>
<p>Lucky for me, SoftLayer launched <a href="http://blog.softlayer.com/2012/softlayer-openstack-swift-softlayer-object-storage/">Object Storage</a> along with a slew of <a href="http://github.com/softlayer">language bindings</a>. After talking with my boss about my blunder, an agreement was made that I should write an object storage backup script. Works out for me quite well as I pay per gigabyte and I won't be using any public bandwidth. With a little over 60GB of content, that only comes out to ~$8 after taxes for my particular use case. I chose to write it in python so it would work on BSD and Linux, but eventually Windows too. It's uses threading (mutliprocessing actually) extensively to work around latency issues round trip HTTP requests. Threading also allows it to read/check multiple files at a time (including checksumming if enabled) since stat() operations are no-op and read from the superblock. For example, with and without checksums enabled I was able to compare an already uploaded directory in 2.4 and 1.5 seconds, respectively.</p>
<p>Flexibility is king when it comes to backups. Depending on your file write patterns you might need rentention policies, point in time snap shots, etc.  The script supports using retentions by default. Rentions are used by creating a container of a similar name with <span class="geshifilter"><code class="text geshifilter-text">-revisions</code></span> appended to it and copying the file to the revisions container. The filename and path is preserved, but with the md5sum injected into the filename just before the extention. So, if <span class="geshifilter"><code class="text geshifilter-text">README.txt</code></span> was updated, it would be copied and renamed to <span class="geshifilter"><code class="text geshifilter-text">README_c36f10fd0ff59c3bcce088d7a7a6c410.txt</code></span>. However, if you just want daily full backups without retention, just disable retentions all together or point it at a new container (this will upload all files though).  Feel free to fork it on github or submit an issue to it on github.  Let us know what you think!</p>
<p>Github: <a href="https://github.com/softlayer/softlayer-object-storage-backup" title="https://github.com/softlayer/softlayer-object-storage-backup">https://github.com/softlayer/softlayer-object-storage-backup</a></p>

